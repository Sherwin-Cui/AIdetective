<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>指证UI调试</title>
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
    <div class="game-container">
        <h1>指证UI调试页面</h1>
        
        <!-- 指证对话容器 -->
        <div id="accusation-dialogue-container" class="accusation-dialogue-container" style="display: none;">
            <div id="dialogue-box" class="dialogue-box">
                <div id="avatar-container">
                    <img id="avatar-image" src="assets/characters/me/detective.png" alt="头像" />
                </div>
                <div id="dialogue-text" class="dialogue-text">点击开始测试按钮开始测试指证UI</div>
            </div>
        </div>

        <!-- 证据选择区域 -->
        <div id="evidence-selection" class="evidence-selection" style="display: none;">
            <h3>选择证据</h3>
            <div class="evidence-grid">
                <div class="evidence-item" data-id="poison_bottle">毒药瓶</div>
                <div class="evidence-item" data-id="love_letter">情书</div>
                <div class="evidence-item" data-id="debt_notice">债务通知</div>
                <div class="evidence-item" data-id="medical_chart">医疗记录</div>
            </div>
        </div>

        <!-- 压力显示 -->
        <div id="pressure-display" class="pressure-display" style="display: none;">
            <span>压力值: </span>
            <span id="pressure-value">0</span>
        </div>

        <!-- 调试按钮 -->
        <div style="margin: 20px; text-align: center;">
            <button id="start-test" onclick="startTest()">开始测试指证UI</button>
            <button id="add-detective" onclick="addDetectiveDialogue()">添加侦探对话</button>
            <button id="add-npc" onclick="addNPCDialogue()">添加NPC对话</button>
            <button id="update-pressure" onclick="updatePressure()">更新压力值</button>
            <button id="end-test" onclick="endTest()">结束测试</button>
        </div>

        <!-- 调试信息 -->
        <div id="debug-info" style="margin: 20px; padding: 10px; background: #f0f0f0; border-radius: 5px;">
            <h3>调试信息</h3>
            <div id="debug-log"></div>
        </div>
    </div>

    <script type="module">
        import AccusationUI from './js/ui/AccusationUI.js';
        
        let accusationUI;
        let testDialogueIndex = 0;
        
        const testDialogues = [
            { speaker: 'detective', text: '我有充分的证据证明你就是真凶！' },
            { speaker: 'npc', text: '你在说什么？我根本不知道你在说什么！', avatar: 'assets/characters/chen_yaqin/calm.png' },
            { speaker: 'detective', text: '那么请你解释一下这个毒药瓶是怎么回事？' },
            { speaker: 'npc', text: '这...这不是我的！一定是有人陷害我！', avatar: 'assets/characters/chen_yaqin/nervous.png' }
        ];
        
        function log(message) {
            const debugLog = document.getElementById('debug-log');
            const time = new Date().toLocaleTimeString();
            debugLog.innerHTML += `<div>[${time}] ${message}</div>`;
            console.log(`[AccusationUI Debug] ${message}`);
        }
        
        window.startTest = function() {
            try {
                log('开始初始化AccusationUI...');
                accusationUI = new AccusationUI();
                log('AccusationUI初始化成功');
                
                log('启动指证模式...');
                accusationUI.startAccusationMode();
                log('指证模式启动成功');
                
                testDialogueIndex = 0;
            } catch (error) {
                log(`错误: ${error.message}`);
                console.error(error);
            }
        };
        
        window.addDetectiveDialogue = function() {
            if (!accusationUI) {
                log('请先开始测试');
                return;
            }
            
            try {
                const dialogue = testDialogues.find(d => d.speaker === 'detective');
                accusationUI.addDialogue('detective', dialogue.text);
                accusationUI.showNextDialogue();
                log('添加侦探对话成功');
            } catch (error) {
                log(`添加侦探对话失败: ${error.message}`);
            }
        };
        
        window.addNPCDialogue = function() {
            if (!accusationUI) {
                log('请先开始测试');
                return;
            }
            
            try {
                const npcDialogue = testDialogues.find(d => d.speaker === 'npc');
                accusationUI.addDialogue('npc', npcDialogue.text, npcDialogue.avatar);
                accusationUI.showNextDialogue();
                log('添加NPC对话成功');
            } catch (error) {
                log(`添加NPC对话失败: ${error.message}`);
            }
        };
        
        window.updatePressure = function() {
            if (!accusationUI) {
                log('请先开始测试');
                return;
            }
            
            try {
                const newPressure = Math.floor(Math.random() * 100);
                accusationUI.updatePressure(newPressure);
                log(`压力值更新为: ${newPressure}`);
            } catch (error) {
                log(`更新压力值失败: ${error.message}`);
            }
        };
        
        window.endTest = function() {
            if (!accusationUI) {
                log('请先开始测试');
                return;
            }
            
            try {
                accusationUI.endAccusationMode();
                log('指证模式结束');
            } catch (error) {
                log(`结束指证模式失败: ${error.message}`);
            }
        };
        
        // 页面加载完成后的初始化
        document.addEventListener('DOMContentLoaded', function() {
            log('页面加载完成，准备测试AccusationUI');
        });
    </script>
</body>
</html>