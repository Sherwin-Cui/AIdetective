# AI服务配置说明

## 概述

本游戏使用Ollama作为本地LLM服务提供者。Ollama允许在本地运行大型语言模型，无需联网即可获得AI对话功能。

## 安装Ollama

1. 访问 [Ollama官网](https://ollama.com/) 下载适用于您操作系统的安装包
2. 按照官方指南完成安装
3. 启动Ollama服务

## 模型配置

### 推荐模型

游戏推荐使用以下模型以获得最佳性能和体验：

1. **qwen2:1.5b** - 阿里云通义千问系列，中文理解能力强
2. **llama3:8b** - Meta的Llama3系列，通用性强
3. **mistral:7b** - Mistral AI的模型，推理能力优秀

### 模型下载

打开终端并执行以下命令下载推荐模型：

```bash
# 下载qwen2:1.5b模型
ollama pull qwen2:1.5b

# 下载llama3:8b模型
ollama pull llama3:8b

# 下载mistral:7b模型
ollama pull mistral:7b
```

### 模型切换

游戏默认使用`qwen2:1.5b`模型。如需切换模型，请修改`js/ai/SimpleAIService.js`文件中的`DEFAULT_MODEL`常量：

```javascript
// 修改此行以切换模型
const DEFAULT_MODEL = 'qwen2:1.5b'; // 可替换为 'llama3:8b' 或 'mistral:7b'
```

## API配置

### 服务地址

Ollama默认运行在本地`http://localhost:11434`，无需额外配置。

### API密钥

Ollama本地服务无需API密钥，可直接使用。

## 性能优化建议

### 硬件要求

- **CPU**：至少4核心
- **内存**：至少8GB RAM
- **存储**：至少20GB可用空间

### 模型选择建议

1. **性能优先**：选择`qwen2:1.5b`，响应速度快，资源占用少
2. **质量优先**：选择`llama3:8b`，回复质量高，但需要更多资源
3. **平衡选择**：选择`mistral:7b`，在性能和质量间取得平衡

### 提示词优化

为了获得更好的AI响应，建议：

1. 使用详细的角色背景信息
2. 明确指定回复要求
3. 提供充分的上下文信息
4. 避免模糊或歧义的表述

## 故障排除

### 常见问题

#### 1. 无法连接到Ollama服务

**问题描述**：游戏提示无法连接到AI服务

**解决方案**：
- 确认Ollama服务已启动
- 检查网络连接
- 确认服务地址配置正确

#### 2. AI响应缓慢

**问题描述**：AI回复需要很长时间

**解决方案**：
- 检查硬件资源使用情况
- 尝试切换到较小的模型
- 关闭其他占用资源的程序

#### 3. AI回复不相关

**问题描述**：AI回复与问题无关

**解决方案**：
- 检查提示词模板是否正确
- 确认角色设定清晰明确
- 尝试重新启动对话

### 日志查看

如需查看详细错误信息，请打开浏览器开发者工具（F12），在Console标签页中查看错误日志。

## 高级配置

### 自定义模型

如需使用其他Ollama支持的模型，请：

1. 从Ollama库中选择合适的模型
2. 使用`ollama pull`命令下载模型
3. 修改`SimpleAIService.js`中的模型配置

### 参数调优

可以通过修改`SimpleAIService.js`中的参数来调整AI行为：

```javascript
const DEFAULT_PARAMS = {
    temperature: 0.7,     // 控制回复随机性，值越高越随机
    top_p: 0.9,          // 控制核采样，影响回复多样性
    repeat_penalty: 1.1, // 重复惩罚，防止重复回复
    num_predict: 500     // 最大回复长度
};
```

### 本地模型微调

对于高级用户，可以对模型进行微调以适应特定角色：

1. 准备训练数据集
2. 使用Ollama的微调工具
3. 创建自定义模型
4. 在游戏中配置使用自定义模型

## 版本兼容性

### Ollama版本

游戏已测试以下Ollama版本：
- v0.1.30
- v0.1.31
- v0.1.32

### 浏览器兼容性

游戏支持以下现代浏览器：
- Chrome 90+
- Firefox 88+
- Safari 15+
- Edge 90+

## 更新日志

### v1.0.0
- 初始版本发布
- 支持Ollama本地LLM服务
- 集成5个AI角色
- 实现情绪化对话响应
- 实现智能线索触发机制

### v1.1.0
- 优化提示词模板
- 增强情绪分析功能
- 添加角色一致性测试工具
- 添加集成测试报告